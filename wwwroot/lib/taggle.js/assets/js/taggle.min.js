(function(e,t){function a(){if(!(2>arguments.length)){for(var e=arguments[0],t=1,a=arguments.length;a>t;t++){var n=arguments[t];for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e}}function n(e,t){var a="a"===e.tagName.toLowerCase()?e.parentNode:e,n=t.elements.indexOf(a);t.elements.splice(n,1),t.values.splice(n,1)}function o(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent?e.attachEvent("on"+t,a):e["on"+t]=a}function i(e){return e.replace(/^\s+|\s+$/g,"")}var l={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:[],tabIndex:1,placeholder:"Enter tags..."},r=8,s=188,c=9,u=13,d=function(e,n){var o=this;o.container=e,o.options=a({},l,n),o.tag={values:[],elements:[]},o.measurements={container:{rect:null,style:null,side_padding:null}},o.list=t.createElement("ul"),o.input_li=t.createElement("li"),o.input=t.createElement("input"),o.options.placeholder&&(o.placeholder=t.createElement("span")),"string"==typeof e&&(o.container=t.getElementById(e)),o.init()};d.prototype.init=function(){var e=this;e.getMeasurements(),e.setupTextarea(),e.attachEvents()},d.prototype.getMeasurements=function(){var t,a,n,o=this;o.measurements.container.rect=o.container.getBoundingClientRect(),o.measurements.container.style=e.getComputedStyle(o.container),t=o.measurements.container.style,a=parseInt(t["padding-left"]||t.paddingLeft,10),n=parseInt(t["padding-right"]||t.paddingRight,10),o.measurements.container.side_padding=a+n},d.prototype.setupTextarea=function(){var a,n=this;if(n.list.className="taggle_list",n.input.type="text",n.input.className="taggle_input",n.input.tabIndex=n.options.tabIndex,n.sizer=t.createElement("div"),n.sizer.className="taggle_sizer",null!==n.options.tags)for(var o=0,i=n.options.tags.length;i>o;o++){var l=n.createTag(n.options.tags[o]);n.list.appendChild(l)}n.placeholder&&(n.placeholder.style.opacity=0,n.placeholder.classList.add("taggle_placeholder"),n.container.appendChild(n.placeholder),n.placeholder.textContent=n.options.placeholder,n.options.tags.length||(n.placeholder.style.opacity=1)),n.input_li.appendChild(n.input),n.list.appendChild(n.input_li),n.container.appendChild(n.list),n.container.appendChild(n.sizer),a=e.getComputedStyle(n.input)["font-size"],n.sizer.style.fontSize=a},d.prototype.attachEvents=function(){var e=this;o(e.container,"click",function(){e.input.focus()}),e.input.onfocus=e.focusInput.bind(e),e.input.onblur=e.blurInput.bind(e),o(e.input,"keydown",e.keydownEvents.bind(e)),o(e.input,"keyup",e.keyupEvents.bind(e))},d.prototype.fixInputWidth=function(){var e,t,a,n,o=this;o.setInputWidth(),t=o.input.getBoundingClientRect(),e=~~o.measurements.container.rect.width,a=~~t.left-~~o.measurements.container.rect.left,n=o.measurements.container.side_padding,o.setInputWidth(e-a-n)},d.prototype.add=function(e){var t,a,n=this,o="string"==typeof e?e.toLowerCase():i(n.input.value.toLowerCase());return!n.options.allowDuplicates&&n.hasDupes()||""===o?n:(t=n.createTag(o),a=n.list.querySelector("li:last-child"),n.list.insertBefore(t,a),n.input.value="",n.setInputWidth(),n.fixInputWidth(),n.focusInput(),n)},d.prototype.checkLastTag=function(t){t=t||e.event;var a=this,n=a.container.querySelectorAll(".taggle"),o=n[n.length-1],i="taggle_hot";""===a.input.value&&t.keyCode===r?o.classList.contains(i)?(a.remove(o),a.fixInputWidth(),a.focusInput()):o.classList.add(i):o.classList.contains(i)&&o.classList.remove(i)},d.prototype.setInputWidth=function(e){this.input.style.width=(e||10)+"px"},d.prototype.hasDupes=function(e){var t,a=this,n=a.input.value,o=e?e.toLowerCase():i(n.toLowerCase()),l=a.tag.values.indexOf(o),r=a.container.querySelector(".taggle_list");if(a.options.duplicateTagClass){t=r.querySelectorAll("."+a.options.duplicateTagClass);for(var s=0,c=t.length;c>s;s++)t[s].classList.remove(a.options.duplicateTagClass)}return l>-1?(a.options.duplicateTagClass&&r.childNodes[l].classList.add(a.options.duplicateTagClass),!0):!1},d.prototype.isConfirmKey=function(e){var t=e.keyCode,a=!1;return(t===s||t===c||t===u)&&(a=!0),a},d.prototype.focusInput=function(){var e=this;e.fixInputWidth(),e.container.classList.contains(e.options.containerFocusClass)||e.container.classList.add(e.options.containerFocusClass),e.placeholder&&(e.placeholder.style.opacity=0)},d.prototype.blurInput=function(){var e=this;e.input.value="",e.setInputWidth(),e.container.classList.contains(e.options.containerFocusClass)&&e.container.classList.remove(e.options.containerFocusClass),!e.tag.values.length&&e.placeholder&&(e.placeholder.style.opacity=1)},d.prototype.keydownEvents=function(t){t=t||e.event;var a=this;return a.listenForEndOfContainer(),a.isConfirmKey(t)&&""!==a.input.value?(a.confirmValidTagEvent(t),undefined):(a.tag.values.length&&a.checkLastTag(t),undefined)},d.prototype.keyupEvents=function(t){t=t||e.event;var a=this;a.sizer.textContent=a.input.value},d.prototype.confirmValidTagEvent=function(t){t=t||e.event;var a=this;a.add(),t.preventDefault?t.preventDefault():t.returnValue=!1},d.prototype.listenForEndOfContainer=function(){var e=this,t=e.sizer.getBoundingClientRect().width,a=e.measurements.container.rect.width-e.measurements.container.side_padding,n=parseInt(e.sizer.style.fontSize,10);t+1.5*n>parseInt(e.input.style.width,10)&&(e.input.style.width=a+"px")},d.prototype.createTag=function(e){var a=this,n=t.createElement("li"),o=t.createElement("a"),i=t.createElement("input"),l=t.createElement("span");return e=e.toLowerCase(),o.href="javascript:void(0)",o.innerHTML="&times;",o.className="close",o.onclick=a.remove.bind(a,o),l.textContent=e,l.className="taggle_text",n.className="taggle "+a.options.additionalTagClasses,i.type="hidden",i.value=e,i.name=a.options.hiddenInputName,n.appendChild(l),n.appendChild(o),n.appendChild(i),a.tag.values.push(e),a.tag.elements.push(n),n},d.prototype.remove=function(t){t=t||e.event;var a=this,o=t.target||t.srcElement||t,i=o;"li"!==i.tagName.toLowerCase()&&(i=i.parentNode),i.parentNode.removeChild(i),n(i,a.tag),a.focusInput()},d.prototype.getTags=function(){return this.tag},d.prototype.getTagElements=function(){return this.tag.elements},d.prototype.getTagValues=function(){return this.tag.values},d.prototype.getInput=function(){return this.input},d.prototype.getContainer=function(){return this.container},Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),a=this,n=function(){},o=function(){return a.apply(this instanceof n&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,o.prototype=new n,o}),e.Taggle=d})(window,document);